# Anime Collection Feature

The Anime Collection feature allows users to create and manage their personal anime collections. Users can search for anime using the Jikan API (MyAnimeList API), add them to their collection with a status and personal score, and organize their viewing experience.

## Components

### Main Components

- **Collection Page** (`app/collection/page.tsx`)
  - Server component that verifies user authentication and fetches the user's anime collection from Supabase
  - Redirects unauthenticated users to the login page
  - Displays either the empty state or the anime collection based on user data

- **AnimeCollection** (`components/collection/anime-collection.tsx`)
  - Client component that displays the user's anime collection
  - Provides tabs for filtering by status (All, Watching, Completed, Plan to Watch, Dropped)
  - Displays anime cards with details and allows removal of anime from the collection

- **CollectionEmptyState** (`components/collection/collection-empty-state.tsx`)
  - Displayed when a user has no anime in their collection
  - Shows a friendly message and a button to add their first anime

### Dialog Components

- **AddAnimeDialog** (`components/collection/add-anime-dialog.tsx`)
  - Modal dialog for searching and adding anime to the collection
  - Handles API calls to Jikan API for anime search
  - Manages state transitions between search and selection
  - Handles saving selected anime to the user's collection in Supabase

- **AnimeSearchResults** (`components/collection/anime-search-results.tsx`)
  - Displays search results from the Jikan API
  - Shows loading state during API calls
  - Renders a grid of anime cards with basic information

- **SelectedAnimeDetails** (`components/collection/selected-anime-details.tsx`)
  - Shows detailed information about a selected anime
  - Provides controls for selecting status and score
  - Handles submission to the user's collection

- **AddAnimeToCollectionButton** (`components/collection/add-anime-to-collection-button.tsx`)
  - Button component that opens the add anime dialog
  - Reusable across different parts of the application

## Features

- **Search Anime**: Search for anime using the Jikan API with real-time results
- **Add to Collection**: Add anime to personal collection with custom status and score
- **Filter Collection**: Filter anime by status (Watching, Completed, etc.)
- **Remove from Collection**: Remove anime from collection with confirmation dialog
- **Responsive Design**: Works seamlessly on mobile and desktop devices

## Database Schema

The collection feature uses the `anime_lists` table in Supabase with the following structure:

```sql
CREATE TABLE public.anime_lists (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id UUID NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
    anime_id INTEGER NOT NULL,
    title TEXT NOT NULL,
    image_url TEXT,
    type TEXT,
    episodes INTEGER DEFAULT 0,
    status TEXT DEFAULT 'plan_to_watch',
    score INTEGER DEFAULT 0,
    year INTEGER,
    studio TEXT,
    mal_score NUMERIC(3, 2),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
    UNIQUE(user_id, anime_id)
);
```

## Row-Level Security

The anime_lists table implements Row-Level Security to ensure users can only access and modify their own data:

- Users can only view their own anime lists
- Users can only insert entries with their own user_id
- Users can only update their own anime lists
- Users can only delete their own anime lists

## API Integration

The feature integrates with the Jikan API (https://api.jikan.moe/v4) to search for anime and retrieve anime details. This is a public API that provides access to MyAnimeList data.

## Future Improvements

Potential future enhancements for the collection feature:

1. Add episode tracking to mark progress through series
2. Implement sorting options (alphabetical, score, recently updated)
3. Add notes/comments for each anime in the collection
4. Create statistics and reporting on watching habits
5. Add bulk import/export functionality 